<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template.xhtml">

	<ui:define name="body">
		<h1></h1>
		<!--******************** MODALES ******************-->
		<!-- ****Modal tab02**** Escala Contenido Funcional-->
		<rich:modalPanel id="valoracionMiniModal" width="550" height="350"
			autosized="false" resizeable="false" moveable="false">

			<f:facet name="header">#{messages.Tab02_Title_Popup}</f:facet>
			<h:form>
				<rich:panel style="border:none;" id="tab1">
					<div style="clear: both; overflow: auto; HEIGHT: 250px">
						<rich:dataTable id="tablaPopupTab2" cellpadding="0"
							cellspacing="0" width="600" border="0" var="var"
							value="#{administrarCptFormController.listaValoracionTab2}">

							<f:facet name="header">
								<rich:columnGroup>
									<rich:column rowspan="2" width="100px">
										<h:outputText value="#{messages.Tab02_Tipo}" />
									</rich:column>
									<rich:column colspan="3" width="400px">
										<h:outputText value="#{messages.Tab02_Escalas}" />
									</rich:column>
									<rich:column breakBefore="true">
										<h:outputText value="#{messages.Tab02_Descripcion}" />
									</rich:column>

								</rich:columnGroup>
							</f:facet>
							<rich:column colspan="4" style="background-color:lightgrey;"
								width="50px">
								<h:outputText value="#{var.descripcion}" />
							</rich:column>
							<rich:subTable var="detalle"
								value="#{administrarCptFormController.traerValorNivelOrg(var.idContenidoFuncional)}"
								rowKeyVar="subRow">
								<rich:column width="50px;" style="text-align: center;">
									<h:outputText value="#{detalle.desde} - #{detalle.hasta}"
										size="50" />
								</rich:column>
								<rich:column width="350px;">
									<h:outputText value="#{detalle.descripcion}" size="50" />
								</rich:column>
							</rich:subTable>
						</rich:dataTable>
					</div>

					<rich:spacer height="20px" />
					<div class="actionButtons" align="center">
						<a:commandButton id="cancel_tap03" value="Volver"
							ajaxSingle="true"
							oncomplete="Richfaces.hideModalPanel('valoracionMiniModal')" />
					</div>
				</rich:panel>
			</h:form>
		</rich:modalPanel>
		<!-- ****Modal tab03**** Escala Requisitos Minimos -->
		<rich:modalPanel id="valoracionTab03MiniModal" width="550"
			height="350" autosized="false" resizeable="false" moveable="false">
			<f:facet name="header">#{messages.Tab03_Title_popup}</f:facet>
			<h:form>
				<rich:panel style="border:none;" id="tab03">

					<div style="clear: both; overflow: auto; HEIGHT: 250px">
						<rich:dataTable id="tablaPopupTab3" cellpadding="0"
							cellspacing="0" width="600" border="0" var="var"
							value="#{administrarCptFormController.listaValoracionTab3}">

							<f:facet name="header">
								<rich:columnGroup>
									<rich:column rowspan="2" width="100px">
										<h:outputText value="#{messages.Tab02_Tipo}" />
									</rich:column>
									<rich:column colspan="3" width="400px">
										<h:outputText value="#{messages.Tab02_Escalas}" />
									</rich:column>
									<rich:column breakBefore="true">
										<h:outputText value="#{messages.Tab02_Descripcion}" />
									</rich:column>

								</rich:columnGroup>
							</f:facet>
							<rich:column colspan="4" style="background-color:lightgrey;"
								width="50px">
								<h:outputText value="#{var.descripcion}" />
							</rich:column>
							<rich:subTable var="detalle"
								value="#{administrarCptFormController.traerEscalaReqMin(var.idRequisitoMinimoCpt)}"
								rowKeyVar="subRow">
								<rich:column width="50px;" style="text-align: center;">
									<h:outputText value="#{detalle.desde} - #{detalle.hasta}"
										size="50" />
								</rich:column>
								<rich:column width="350px;">
									<h:outputText value="#{detalle.descripcion}" size="50" />
								</rich:column>
							</rich:subTable>
						</rich:dataTable>
					</div>
					<div style="clear: both" />
					<rich:spacer height="20px" />
					<div class="actionButtons" align="center">
						<a:commandButton id="cancel_tap03" value="Cancelar"
							ajaxSingle="true"
							oncomplete="Richfaces.hideModalPanel('valoracionTab03MiniModal')" />
					</div>
				</rich:panel>
			</h:form>
		</rich:modalPanel>

		<!-- ****Modal tab04**** -->
		<rich:modalPanel id="valoracionTab04MiniModal" width="550"
			height="350" autosized="false" resizeable="false" moveable="false">
			<f:facet name="header">#{messages.Tab04_Title_popup}</f:facet>
			<h:form>
				<rich:panel style="border:none;" id="tab03">

					<div style="clear: both; overflow: auto; HEIGHT: 250px">
						<rich:dataTable id="tablaPopupTab4" cellpadding="0"
							cellspacing="0" width="600" border="0" var="var"
							value="#{administrarCptFormController.listaValoracionTab4}">

							<f:facet name="header">
								<rich:columnGroup>
									<rich:column rowspan="2" width="100px">
										<h:outputText value="#{messages.Tab02_Tipo}" />
									</rich:column>
									<rich:column colspan="3" width="400px">
										<h:outputText value="#{messages.Tab02_Escalas}" />
									</rich:column>
									<rich:column breakBefore="true">
										<h:outputText value="#{messages.Tab02_Descripcion}" />
									</rich:column>

								</rich:columnGroup>
							</f:facet>
							<rich:column colspan="4" style="background-color:lightgrey;"
								width="50px">
								<h:outputText value="#{var.descripcion}" />
							</rich:column>
							<rich:subTable var="detalle"
								value="#{administrarCptFormController.traerEscalaCondTrab(var.idCondicionTrabajo)}"
								rowKeyVar="subRow">
								<rich:column width="50px;" style="text-align: center;">
									<h:outputText value="#{detalle.desde} - #{detalle.hasta}"
										size="50" />
								</rich:column>
								<rich:column width="350px;">
									<h:outputText value="#{detalle.descripcion}" size="50" />
								</rich:column>
							</rich:subTable>
						</rich:dataTable>
					</div>
					<div style="clear: both" />
					<rich:spacer height="20px" />
					<div class="actionButtons" align="center">
						<a:commandButton id="cancel_tap03" value="Cancelar"
							ajaxSingle="true"
							oncomplete="Richfaces.hideModalPanel('valoracionTab04MiniModal')" />
					</div>
				</rich:panel>
			</h:form>
		</rich:modalPanel>

		<!-- ****Modal tab05**** -->
		<rich:modalPanel id="valoracionTab05MiniModal" width="650"
			height="350" autosized="false" resizeable="false" moveable="false">
			<f:facet name="header">#{messages.Tab05_Title_popup}</f:facet>
			<h:form>
				<rich:panel style="border:none;" id="tab05">

					<div style="clear: both; overflow: auto; HEIGHT: 250px">
						<rich:dataTable id="tablaPopupTab5" cellpadding="0"
							cellspacing="0" width="700" border="0" var="val"
							value="#{administrarCptFormController.listaValoracionTab5}">

							<f:facet name="header">
								<rich:columnGroup>
									<rich:column rowspan="2" width="100px">
										<h:outputText value="#{messages.Tab02_Tipo}" />
									</rich:column>
									<rich:column colspan="3" width="400px">
										<h:outputText value="#{messages.Tab02_Escalas}" />
									</rich:column>
									<rich:column breakBefore="true">
										<h:outputText value="#{messages.Tab02_Descripcion}" />
									</rich:column>
								</rich:columnGroup>
							</f:facet>
							<rich:column colspan="1" style="background-color:lightgrey;"
								width="100px">
								<h:outputText value="#{val.condicionTrabajoEspecif.tipo}" />
							</rich:column>
							<rich:column colspan="4" style="background-color:lightgrey;"
								width="100px">
								<h:outputText value="#{val.condicionTrabajoEspecif.descripcion}" />
							</rich:column>
							<rich:subTable var="detalle" value="#{val.listaEscala}"
								rowKeyVar="subRow">
								<rich:column width="50px;" style="text-align: center;">
									<h:outputText value="#{detalle.desde} - #{detalle.hasta}"
										size="50" />
								</rich:column>
								<rich:column width="350px;">
									<h:outputText value="#{detalle.descripcion}" size="50" />
								</rich:column>
							</rich:subTable>
						</rich:dataTable>
					</div>
					<div style="clear: both" />
					<rich:spacer height="20px" />
					<div class="actionButtons" align="center">
						<a:commandButton id="cancel_tap03" value="Cancelar"
							ajaxSingle="true"
							oncomplete="Richfaces.hideModalPanel('valoracionTab05MiniModal')" />
					</div>
				</rich:panel>
			</h:form>
		</rich:modalPanel>

		<!-- ****Modal tab06**** -->
		<rich:modalPanel id="valoracionTab06MiniModal" width="650"
			height="350" autosized="false" resizeable="false" moveable="false">
			<f:facet name="header">#{messages.Tab06_Title_popup}</f:facet>
			<h:form>
				<rich:panel style="border:none;" id="tab06">

					<div style="clear: both; overflow: auto; HEIGHT: 250px">
						<rich:dataTable id="tablaPopupTab6" cellpadding="0"
							cellspacing="0" width="700" border="0" var="valor"
							value="#{administrarCptFormController.listaValoracionTab6}">

							<f:facet name="header">
								<rich:columnGroup>
									<rich:column rowspan="2" width="100px">
										<h:outputText value="#{messages.Tab02_Tipo}" />
									</rich:column>
									<rich:column colspan="3" width="400px">
										<h:outputText value="#{messages.Tab02_Escalas}" />
									</rich:column>
									<rich:column breakBefore="true">
										<h:outputText value="#{messages.Tab02_Descripcion}" />
									</rich:column>
								</rich:columnGroup>
							</f:facet>
							<rich:column colspan="1" style="background-color:lightgrey;"
								width="100px">
								<h:outputText value="#{valor.condicionSegur.orden}" />
							</rich:column>
							<rich:column colspan="4" style="background-color:lightgrey;"
								width="100px">
								<h:outputText value="#{valor.condicionSegur.descripcion}" />
							</rich:column>
							<rich:subTable var="detalle" value="#{valor.listaEscalaCondSeg}"
								rowKeyVar="subRow">
								<rich:column width="50px;" style="text-align: center;">
									<h:outputText value="#{detalle.desde} - #{detalle.hasta}"
										size="50" />
								</rich:column>
								<rich:column width="350px;">
									<h:outputText value="#{detalle.descripcion}" size="50" />
								</rich:column>
							</rich:subTable>
						</rich:dataTable>
					</div>
					<div style="clear: both" />
					<rich:spacer height="20px" />
					<div class="actionButtons" align="center">
						<a:commandButton id="cancel_tap03" value="Cancelar"
							ajaxSingle="true"
							oncomplete="Richfaces.hideModalPanel('valoracionTab06MiniModal')" />
					</div>
				</rich:panel>
			</h:form>
		</rich:modalPanel>
		
		<h:panelGrid rendered="#{tipo == 'especifico'}">
			<h1>#{messages.Homologacion_Cpt_Especifico}</h1>
		</h:panelGrid>
		<!-- **************** FIN MODALES ********************** -->
		<h:form id="cpt" styleClass="edit">
			<rich:panel id="panelGral">
				
				<f:facet name="header">#{messages.Homologacion_gestionar}</f:facet>


				<h:panelGrid columns="2">
					<rich:panel style="border:none;">
						<a:region>
							<s:decorate id="cptPadreField" template="/layout/edit.xhtml"
								rendered="#{administrarCptFormController.tipo == 'especifico'}">
								<ui:define name="label">CPT</ui:define>

								<h:inputText id="cptPadre" disabled="true"
									value="#{administrarCptFormController.codigoCpt}" size="20">
								</h:inputText>	
		                		#{' '}
		                		<h:inputText id="denominacionCptPadre"
									value="#{administrarCptFormController.cptPadre.denominacion}"
									size="50" disabled="true" />
                				#{' '}
                				<a:commandButton id="searchCpt"
									eventsQueue="default" image="/img/Buscar.png"
									rendered="#{!cptHome.managed}"
									action="#{administrarCptFormController.getUrlToPageCpt()}" />
							</s:decorate>
						</a:region>

						<a:region>
							<s:decorate id="tipoCptField" template="/layout/edit.xhtml">
								<ui:define name="label">#{messages.Cpt_idTipoCpt}</ui:define>
								<h:selectOneMenu id="tipoCpt" required="true"
									style="width:250px;" disabled="#{tipo != 'general'}"
									value="#{administrarCptFormController.idTipoCpt}">
									<f:selectItems value="#{tipoCptsSelectItems}" />

									<a:support event="onchange"
										action="#{administrarCptFormController.cargarVariable()}" />
								</h:selectOneMenu>
							</s:decorate>
						</a:region>


						

						

						


						<a:region>
							<s:decorate id="denominacionField" template="/layout/edit.xhtml">
								<ui:define name="label">#{messages.Cpt_denominacion}</ui:define>
								<h:inputText id="denominacion" required="true" disabled="true"
									size="50" maxlength="200"
									value="#{administrarCptFormController.cpt.denominacion}">
									<a:support event="onblur" />
								</h:inputText>
							</s:decorate>
						</a:region>
		<a:region>
		<s:decorate id="cptCategoriaField" template="/layout/edit.xhtml">
			<ui:define name="label"></ui:define>
			
			<s:button view="/planificacion/cpt/CptHomologacionObservacionSfp.xhtml"
                    id="create"
           			propagation="none"
           			rendered="#{administrarCptFormController.habilitarObservacionSfp}"
                 value="#{messages.CU52_nueva_obs}" >
             	<f:param name="cptIdCpt" value="#{administrarCptFormController.cpt.idCpt}" />
	            <f:param name="idCpt" value="#{administrarCptFormController.cpt.idCpt}"/>
	            <f:param name="idCptObs" value="" />
	            
       		</s:button>
       		
       		<h:commandButton id="save"
                          value="Homologar"
                         action="#{administrarCptFormController.homologar()}"
                        onclick="return confirm('#{messages.msg_confirm_homologacion}');"
                       rendered="#{administrarCptFormController.habilitarHomologar}"/>

			
			<h:commandButton id="print" value="Imprimir CPT"
								action="#{administrarCptFormController.imprimirCptNuevoEscalasParametros()}" />
								
			<s:button view="/planificacion/cpt/Cpt.xhtml" value="Ver Datos del CPT Específico"
                    id="dataView"
           			propagation="none">
             		<f:param name="cptIdCpt" value="#{administrarCptFormController.cpt.idCpt}" />
					<f:param name="tipo" value="#{tipo}"/>
					<f:param name="cptFrom" value="/planificacion/cpt/CptGestionarHomologacion" />
       		</s:button>

		</s:decorate>
	</a:region>

					</rich:panel>
				</h:panelGrid>
				<!-- ventana emergente 1 -->
				<rich:modalPanel id="pnl1" autosized="true" resizeable="false">
					<f:facet name="header">
						<h:outputText value="Ver Detalles CPT" />
					</f:facet>
					<f:facet name="controls">
						<h:graphicImage value="/img/close.png" height="15px" width="15px"
							style="cursor:pointer" onclick="Richfaces.hideModalPanel('pnl1')" />
					</f:facet>
					<a:include id="includeVerDetalles"
						viewId="/planificacion/cpt/VerDetalles.xhtml" />
				</rich:modalPanel>


				<h:panelGrid id="mostrarPanel">
					

				</h:panelGrid>
				


				

				
				<br />
				

			</rich:panel>
			
			
<rich:panel>
        <f:facet name="header">#{messages.CU52_obs_resp} (#{administrarCptFormController.listaCptObs.size()==0 ? 0 : administrarCptFormController.listaCptObs.size()})</f:facet>
    <div class="results" id="ListaCpt">
    

    <h:outputText  value="#{messages.msg_list_search_no_results}"
               rendered="#{empty administrarCptFormController.listaCptObs}"/>


    <rich:dataTable id="CptObsList"
                var="_cptObs"
                rows="#{administrarCptFormController.listaCptObs.size()}"
              value="#{administrarCptFormController.listaCptObs}"
           rendered="#{not empty administrarCptFormController.listaCptObs}">
           
        
       
       
        <h:column>
            <f:facet name="header">
                <ui:include src="/layout/sort.xhtml">
                    <ui:param name="entityList" value="#{CptObsList}"/>
                    <ui:param name="propertyLabel" value="#{messages.CU52_obs}"/>
                    <ui:param name="propertyPath" value="CptObsList.observacion"/>
                </ui:include>
            </f:facet>
            <h:outputText value="#{_cptObs.observacionSfp}"/>
        </h:column>
        <!-- FECHA DE OBSERVACION -->
         <h:column>
            <f:facet name="header">
                <ui:include src="/layout/sort.xhtml">
                   <ui:param name="entityList" value="#{CptObsList}"/>
                    <ui:param name="propertyLabel" value="#{messages.CU52_fecha}"/>
                    <ui:param name="propertyPath" value=""/>
                </ui:include>
            </f:facet>
            <h:outputText value="#{_cptObs.fechaObservacionSfp}">
              	<s:convertDateTime pattern="dd/MM/yyyy" locale="ES"/>
            </h:outputText>
        </h:column>
      
      
        <h:column>
            <f:facet name="header">
                <ui:include src="/layout/sort.xhtml">
                    <ui:param name="entityList" value="#{CptObsList}"/>
                    <ui:param name="propertyLabel" value="#{messages.CU52_repuesta}"/>
                    <ui:param name="propertyPath" value=""/>
                </ui:include>
            </f:facet>
            <h:outputText value="#{_cptObs.respuestaOee}"/>
        </h:column>
        <h:column>
            <f:facet name="header">
                <ui:include src="/layout/sort.xhtml">
                    <ui:param name="entityList" value="#{CptObsList}"/>
                    <ui:param name="propertyLabel" value="#{messages.CU52_fecha}"/>
                    <ui:param name="propertyPath" value=""/>
                </ui:include>
            </f:facet>
            <h:outputText value="#{_cptObs.fechaRespuestaOee}">
              	<s:convertDateTime pattern="dd/MM/yyyy" locale="ES"/>
            </h:outputText>
        </h:column>
        <rich:column styleClass="action">
					<f:facet name="header">#{messages.msg_list_action_column}</f:facet>
  	        #{' '}
  	        <s:link view="/planificacion/cpt/CptEdit.xhtml"
						value="Editar CPT" propagation="none" id="cptEdit"
						rendered="#{administrarCptFormController.habilitarRespuestaOee}"
						disabled="#{!_cptObs.activo or !administrarCptFormController.deshabilitarEnvioObservacion(_cptObs)}"
						>
						<f:param name="cptIdCpt" value="#{_cptObs.cpt.idCpt}" />
						<f:param name="tipo" value="#{tipo}" />
					</s:link>
					#{' '}	
					 <s:link
						view="/planificacion/cpt/CptHomologacionObservacionSfp.xhtml"
						rendered="#{administrarCptFormController.habilitarEditarObservacionSfp }"					
						disabled="#{administrarCptFormController.deshabilitarEditar(_cptObs)}"
						value="Editar Observación" propagation="none">
						<f:param name="idCptObs"
							value="#{_cptObs.idCptObs}" />
					</s:link>
  	        
  	        #{' '}
            <s:link
						view="/planificacion/cpt/CptHomologacionRespuestaOee.xhtml"
						value="Ver Respuesta" propagation="none"
						rendered="#{administrarCptFormController.habilitarObservacionSfp}"
						disabled="#{!administrarCptFormController.tieneRespuesta(_cptObs)}">
						<f:param name="idCptObs"
							value="#{_cptObs.idCptObs}" />
							
					</s:link>
					 #{' '}
            <s:link
						view="/planificacion/cpt/CptHomologacionRespuestaOee.xhtml"
						value="Cargar Respuesta" propagation="none"
						rendered="#{administrarCptFormController.habilitarRespuestaOee}"
						disabled="#{!_cptObs.activo or !administrarCptFormController.deshabilitarEnvioObservacion(_cptObs) }">
						<f:param name="idCptObs"
							value="#{_cptObs.idCptObs}" />
							
					</s:link>
					 #{' '}
			<h:commandLink id="solicitud" value="Enviar Respuesta"
							
							action="#{cptListFormController.enviarRespuesta(_cptObs.idCptObs)}"
							onclick="return confirm('#{messages.msg_confirm_respuesta_cpt}');" 
							rendered="#{administrarCptFormController.habilitarEditarRespuestaOee }"
							disabled="#{administrarCptFormController.deshabilitarEnvioRespuesta(_cptObs)}"
							/>	
							
							 #{' '}
			<h:commandLink id="enviarObservacion" value="Enviar Observación"
							
							action="#{cptListFormController.enviarObservacion(_cptObs.idCptObs)}"
							onclick="return confirm('#{messages.msg_confirm_observacion_cpt}');" 
							rendered="#{administrarCptFormController.habilitarEditarObservacionSfp }"
							disabled="#{administrarCptFormController.deshabilitarEnvioObservacion(_cptObs)}"
							/>		
					
					 
				</rich:column>
     </rich:dataTable>
    
    
    
    </div>
    			
    </rich:panel>
    
    <s:button 
    		id="cancelEdit" value="Volver" includePageParams="false"
			propagation="none"
			view="/planificacion/cpt/CptHomologacionList.xhtml"> 
			<f:param name="tipo" value="especifico" /> 
					
	</s:button>

				
				
		
	</h:form>	
	</ui:define>

</ui:composition>
